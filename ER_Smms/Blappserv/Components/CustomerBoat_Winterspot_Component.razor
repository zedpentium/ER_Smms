@using System.ComponentModel;

<div> @* Pagewrapper *@

    <div class="border border-1 bg-secondary border-primary rounded-3 p-1">
        <div class="row gx-5">
        <div>  @* Contain box *@
            <div class="bg-dark text-light"> <b>&nbsp;Valda båtens VinterFörvaring:</b> </div>

            @if (ViewModel.SelectedBoatDataId > 0)
            {
                @if (ViewModel.BoatDTO.WinterstoreSpot != null)
                {
                    decimal spotPrice =
                    ViewModel.BoatDTO.WinterstoreSpot.SpotM2 * ViewModel.BoatDTO.WinterstoreSpot.ServiceType.Price;

                    <div class="border border-1 bg-secondary border-primary rounded-3 p-1">
                        <p>
                            <b> PlatsNamn: </b>@ViewModel.BoatDTO.WinterstoreSpot.Label <br />
                            <b> Storlek: </b>L: @ViewModel.BoatDTO.WinterstoreSpot.Length B: @ViewModel.BoatDTO.WinterstoreSpot.Width
                            H: @ViewModel.BoatDTO.WinterstoreSpot.Height
                        </p>
                        <p>
                            <b>Typ: </b>
                            @ViewModel.BoatDTO.WinterstoreSpot.ServiceType.Label
                        </p>


                        <p><b>PlatsPris: </b> @spotPrice.ToString("F") kr</p>

                        <form asp-action="RemoveWinterstoreForSelectedBoat" asp-route-id="@ViewModel.BoatDTO.Id"
                          method="post" role="form"
                          onclick="return confirm('Är du säker på att du vill ta bort VinterförvaringsPlats för denna båt?')">

                            @*@Html.AntiForgeryToken()*@
                            <input type="submit" id="optionBtnRed" value="Ta Bort">
                        </form>
                    </div>
                }
                else
                {
                    <div class="border border-1 bg-secondary border-primary rounded-3 p-1">
                        <p>Ingen Vinterförvaringsplats</p>
                    </div>
                }

            }
        </div>
        </div>
    </div>


                    <br />

                    @if(ViewModel.SelectedBoatDataId > 0)
                    {
                    <div class="border border-1 bg-secondary border-primary rounded-3 p-1">
                        <div class="row">
                            <div>
                                @* Contain box *@
                                @*Debug.WriteLine(JsonConvert.SerializeObject(@Model.FreeBoatslips));*@
                                <div>
                                    @if (@ViewModel.SelectedBoatDataId > 0 && @ViewModel.FreeWinterstoreSpots != null)
                                    {
                                        <div class="bg-dark text-light"> <b>&nbsp;Tilldela/Byta VinterFörvaring: </b> </div>

                                        <form asp-controller="Admin" asp-action="ManageCustomerSaveAssignedWinterstore" method="post" role="form">

                                            <select asp-for="WinterstoreSpotId">
                                                <option value="0" disabled selected>Välj en Ledig BåtPlats</option>

                                                @foreach (WinterstoreSpot freeWinterstore in ViewModel.FreeWinterstoreSpots)
                                                {
                                                    decimal selectSpotPrice =
                                                    @freeWinterstore.SpotM2 * @freeWinterstore.ServiceType.Price;
                                                    <option value="@freeWinterstore.Id">
                                                        @freeWinterstore.Label - Mått:
                                                        L: @freeWinterstore.Length B: @freeWinterstore.Width
                                                        H: @freeWinterstore.Height - Pris: @selectSpotPrice.ToString("F") kr
                                                    </option>
                                                }
                                            </select>
                                            <input asp-for="SelectedBoatDataId" hidden />

                                            <br />

                                            <br />
                                            <div>
                                                <input type="submit" id="optionBtnGreen" value="Tilldela Vald VinterFörvaring">
                                            </div>

                                        </form>
                                    }
                                </div>

                            </div> @* End Contain box*@
                            <br />

                        </div> @* End Row*@

                    </div> @* End BorderDiv *@

                }



                <br />
                <div class="border border-1 bg-secondary border-primary rounded-3 p-1">

                    @if (ViewModel.SelectedBoatDataId > 0)
                    {

                        <input type="button" class="btn btn-secondary"
                           name="btnBack" value="Skapa Ny Vinterförvaringsplats"
                           onclick="createWinterstoreSpot_PartialView('@ViewModel.CustomerAllInfo.UserName');" />
                    }
                </div> @* End -BorderStyle *@



</div> @* pagewrapper *@


@code {

    [CascadingParameter(Name = "ViewModel")]
    IBManageCustomerViewModel ViewModel { get; set; }

    protected override async Task OnInitializedAsync()
    {
        ViewModel.PropertyChanged += async (sender, e) =>
        {
            await InvokeAsync(() =>
            {
                StateHasChanged();
            });
        };
        await base.OnInitializedAsync();
    }


    async void OnPropertyChangedHandler(object sender, PropertyChangedEventArgs e)
    {
        await InvokeAsync(() =>
        {
            StateHasChanged();
        });
    }


    public void Dispose()
    {
        ViewModel.PropertyChanged -= OnPropertyChangedHandler;
    }
}


